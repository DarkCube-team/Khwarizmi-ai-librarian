from modules.base_handler import BaseHandler


class ThesisHandler(BaseHandler):

    def get_content_type(self):
        return 'thesis'

    def format_result(self, result):
        """
        Format thesis for display

        Format:
        ๐ ยซุนููุงูยป
           ูพฺููุดฺฏุฑ: ...
           ููุทุน: ...
           ุฑุดุชู: ...
           ุงุณุชุงุฏ ุฑุงูููุง: ...
           ุงุณุชุงุฏ ูุดุงูุฑ: ...
           ุณุงู: ...
           ุดูุงุฑู: ...
        """
        lines = [f"๐ ยซ{result.get('ุนููุงู', 'ูุงูุดุฎุต')}ยป"]

        if result.get('ููุณูุฏู'):
            lines.append(f"   ูพฺููุดฺฏุฑ: {result['ููุณูุฏู']}")

        if result.get('ููุทุน'):
            lines.append(f"   ููุทุน: {result['ููุทุน']}")

        if result.get('ุฑุดุชู ุชุญุตู'):
            lines.append(f"   ุฑุดุชู: {result['ุฑุดุชู ุชุญุตู']}")

        if result.get('ุงุณุชุงุฏ ุฑุงูููุง'):
            lines.append(f"   ุงุณุชุงุฏ ุฑุงูููุง: {result['ุงุณุชุงุฏ ุฑุงูููุง']}")

        if result.get('ุงุณุชุงุฏ ูุดุงูุฑ'):
            lines.append(f"   ุงุณุชุงุฏ ูุดุงูุฑ: {result['ุงุณุชุงุฏ ูุดุงูุฑ']}")

        if result.get('ุณุงู'):
            lines.append(f"   ุณุงู: {result['ุณุงู']}")

        if result.get('ุดูุงุฑู ุฑุงูููุง'):
            lines.append(f"   ุดูุงุฑู: {result['ุดูุงุฑู ุฑุงูููุง']}")

        return "\n".join(lines)

    def get_system_prompt(self):
        """System prompt for theses"""
        return """
ุดูุง ฺฉ ุฏุณุชุงุฑ ููุดููุฏ ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุฎูุงุฑุฒู ุชูุฑุงู ูุณุชุฏ ฺฉู ุฏุฑ ุฒููู ูพุงุงูโูุงููโูุง ุชุฎุตุต ุฏุงุฑุฏ.

**ููุงูู ููู:**

1. **ููุท ุงุฒ ูพุงุงูโูุงููโูุง ุงุฑุงุฆู ุดุฏู ุงุณุชูุงุฏู ฺฉูุฏ:**
   - ูพุงุงูโูุงููโูุง ฺฉู ุฏุฑ context ุฏุงุฏู ุดุฏู ุฑุง ุฏููุงู ุงุณุชูุงุฏู ฺฉูุฏ
   - ูุฑฺฏุฒ ูฺฏูุฏ "ูพุงุงูโูุงููโุง ูุฏุงุฑู" ุงฺฏุฑ ุฏุฑ context ููุฌูุฏ ุงุณุช

2. **ูุญูู ูพุงุณุฎ:**

   a) **ุฌุณุชุฌู ุงููู**:
      โ ุชูุงู ูพุงุงูโูุงููโูุง ุฏุงุฏู ุดุฏู ุฑุง ูุนุฑู ฺฉูุฏ
      โ ุฏุฑ ุงูุชูุง ูพุดููุงุฏ ููุชุฑ ุฏูุฏ

   b) **ุฏุฑุฎูุงุณุช ุจุดุชุฑ**:
      โ ููุท ูพุงุงูโูุงููโูุง ุฌุฏุฏ ุฑุง ูุนุฑู ฺฉูุฏ

   c) **ุณูุงู ุฏุฑุจุงุฑู ุงุณุชุงุฏ**:
      โ ุชูุฑฺฉุฒ ุฑู ูพุงุงูโูุงููโูุง ููุงู ุงุณุชุงุฏ

3. **ูุฑูุช ุงุณุชุงูุฏุงุฑุฏ:**
```
๐ ยซุนููุงูยป
   ูพฺููุดฺฏุฑ: ...
   ููุทุน: ...
   ุฑุดุชู: ...
   ุงุณุชุงุฏ ุฑุงูููุง: ...
   ุงุณุชุงุฏ ูุดุงูุฑ: ...
   ุณุงู: ...
   ุดูุงุฑู: ...
```

4. **ูพุดููุงุฏ ููุชุฑ (ููู):**
   - ุจุนุฏ ุงุฒ ููุงุด ูุชุงุฌ (ุงฺฏุฑ ุจุดุชุฑ ุงุฒ 5 ุชุง ุจูุฏูุฏ)ุ ุจฺฏู:

   "๐ก ุขุง ูุงูุฏ ูุชุงุฌ ุฑุง ุจุฑ ุงุณุงุณ ุณุงูุ ุงุณุชุงุฏ ุฑุงูููุงุ ููุทุน ุง ุฑุดุชู ุชุญุตู ููุชุฑ ฺฉูุฏุ"

5. **ุฒุจุงู**: ูุงุฑุณุ ุฏูุณุชุงููุ ูุฎุชุตุฑ

6. **ููููุนุชโูุง:**
   - ูุฑฺฏุฒ ูฺฏูุฏ "ูพุงุงูโูุงููโุง ูุฏุงุฑู" ุงฺฏุฑ context ุฏุงุฑุฏ
   - ูุฑฺฏุฒ ูพุงุงูโูุงูู ุฌุนู ูุนุฑู ูฺฉูุฏ
"""

    def get_filters(self):
        if hasattr(self.details_loader, 'get_available_filters'):
            return self.details_loader.get_available_filters()
        return None

    def apply_filters(self, results, filters):
        if not filters:
            return results

        if hasattr(self.details_loader, 'filter_results'):
            return self.details_loader.filter_results(results, filters)

        return results

    def create_filter_suggestion(self, results):
        if len(results) < 5:
            return None

        return "\n\n๐ก ุขุง ูุงูุฏ ูุชุงุฌ ุฑุง ุจุฑ ุงุณุงุณ ุณุงูุ ุงุณุชุงุฏ ุฑุงูููุงุ ููุทุน ุง ุฑุดุชู ุชุญุตู ููุชุฑ ฺฉูุฏุ"
